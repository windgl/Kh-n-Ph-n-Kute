<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G·ª≠i B·∫°n üíå</title>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Quicksand:wght@400;600;700&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <style>
        /* =========================================
           1. RESET & CORE VARIABLES
           ========================================= */
        :root {
            --primary: #ff9a9e;
            --primary-dark: #ff758c;
            --secondary: #fad0c4;
            --accent: #d63384;
            --text-main: #5d4037;
            --paper: #fff9f0;
            --glass-bg: rgba(255, 255, 255, 0.65);
            --glass-border: rgba(255, 255, 255, 0.8);
            --shadow-soft: 0 10px 40px rgba(0, 0, 0, 0.1);
            --shadow-strong: 0 20px 60px rgba(0, 0, 0, 0.2);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%); /* Fallback */
            font-family: 'Quicksand', sans-serif;
            color: var(--text-main);
            overflow: hidden; /* Ch·∫∑n scroll khi ch∆∞a m·ªü th∆∞ */
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        /* L·ªõp n·ªÅn Canvas cho hi·ªáu ·ª©ng tim bay */
        canvas#heart-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background-image: linear-gradient(to top, #fad0c4 0%, #ffd1ff 100%);
        }

        /* L·ªõp m∆∞a r∆°i (Chiikawa & Emoji) */
        #rain-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 99; /* Lu√¥n n·ªïi l√™n tr√™n c√πng */
            display: none; /* ·∫®n m·∫∑c ƒë·ªãnh, hi·ªán khi m·ªü th∆∞ */
        }

        .falling-item {
            position: absolute;
            top: -80px;
            animation: fall linear infinite;
            will-change: transform, opacity;
        }

        .falling-item img {
            display: block;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.1));
        }

        @keyframes fall {
            0% { transform: translateY(-80px) rotate(0deg) translateX(0px); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(110vh) rotate(360deg) translateX(20px); opacity: 0; }
        }

        /* =========================================
           2. ENVELOPE (BAO TH∆Ø) STYLES
           ========================================= */
        .envelope-wrapper {
            position: absolute;
            z-index: 50;
            transition: all 1s ease-in-out;
            cursor: pointer;
        }

        .envelope-wrapper.open {
            transform: scale(3);
            opacity: 0;
            pointer-events: none;
        }

        .envelope {
            position: relative;
            width: 300px;
            height: 200px;
            background: #ff758c;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* N·∫Øp tr√™n c·ªßa bao th∆∞ */
        .envelope::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            border-left: 150px solid transparent;
            border-right: 150px solid transparent;
            border-top: 130px solid #ff9a9e; /* M√†u n·∫Øp */
            transform-origin: top;
            transition: transform 0.6s 0.2s ease-in-out;
            z-index: 5;
        }

        /* C√°c c·∫°nh b√™n */
        .envelope::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            border-left: 150px solid #ffb7b2;
            border-right: 150px solid #ffb7b2;
            border-top: 100px solid transparent;
            border-bottom: 100px solid #ffb7b2;
            border-radius: 0 0 10px 10px;
            z-index: 4;
        }

        /* Tem d√°n tr√°i tim */
        .heart-sticker {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            color: #d63384;
            z-index: 6;
            transition: transform 0.3s;
            animation: pulse 1.5s infinite;
        }

        .envelope:hover .heart-sticker {
            transform: translate(-50%, -50%) scale(1.2);
        }

        .envelope.active::before {
            transform: rotateX(180deg);
            z-index: 1;
        }

        /* Gi·∫•y b√™n trong bao th∆∞ (tr·ªìi l√™n khi m·ªü) */
        .paper-preview {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 260px;
            height: 150px;
            background: #fff;
            border-radius: 5px;
            transition: transform 0.5s 0.8s ease-in-out;
            z-index: 2;
        }

        .envelope.active .paper-preview {
            transform: translateX(-50%) translateY(-80px);
        }

        .click-hint {
            position: absolute;
            bottom: -40px;
            width: 100%;
            text-align: center;
            color: #d63384;
            font-weight: bold;
            font-family: 'Patrick Hand', cursive;
            font-size: 1.2rem;
            animation: bounce 2s infinite;
        }

        /* =========================================
           3. MAIN LETTER (GLASSMORPHISM)
           ========================================= */
        .letter-container {
            position: relative;
            z-index: 10;
            width: 90%;
            max-width: 650px;
            max-height: 90vh; /* Gi·ªõi h·∫°n chi·ªÅu cao */
            display: none; /* ·∫®n ban ƒë·∫ßu */
            opacity: 0;
            transform: scale(0.8) translateY(50px);
            transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            perspective: 1000px;
        }

        .letter-container.show {
            display: block;
            opacity: 1;
            transform: scale(1) translateY(0);
        }

        /* Glass Card */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 2px solid var(--glass-border);
            border-radius: 30px;
            padding: 40px;
            box-shadow: var(--shadow-strong);
            text-align: center;
            overflow-y: auto; /* Scroll n·∫øu d√†i */
            max-height: 85vh;
            transform-style: preserve-3d; /* Cho hi·ªáu ·ª©ng 3D Tilt */
        }

        /* Custom Scrollbar */
        .glass-card::-webkit-scrollbar { width: 8px; }
        .glass-card::-webkit-scrollbar-track { background: rgba(255,255,255,0.3); border-radius: 10px; }
        .glass-card::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }

        h1 {
            font-family: 'Dancing Script', cursive;
            color: var(--accent);
            font-size: 3.5rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 0px #fff;
            transform: translateZ(20px); /* 3D effect */
        }

        .highlight-quote {
            background: #fff;
            padding: 15px 25px;
            border-radius: 20px;
            margin: 20px auto;
            border: 2px dashed var(--primary);
            font-weight: 700;
            color: var(--primary-dark);
            font-size: 1.2rem;
            display: inline-block;
            box-shadow: 5px 5px 0px rgba(255, 154, 158, 0.3);
            transform: translateZ(30px);
        }

        .content-body {
            background: var(--paper);
            padding: 30px;
            border-radius: 15px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.03);
            text-align: left;
            line-height: 1.9;
            font-size: 1.15rem;
            margin-top: 25px;
            position: relative;
            background-image: radial-gradient(#d63384 1px, transparent 1px);
            background-size: 20px 20px; /* Ch·∫•m bi nh·∫π */
            border: 1px solid #eee;
            transform: translateZ(10px);
            min-height: 300px; /* ƒê·∫£m b·∫£o khung kh√¥ng b·ªã nh·∫£y khi ƒëang g√µ */
        }

        /* Con tr·ªè nh·∫•p nh√°y khi g√µ */
        .cursor {
            display: inline-block;
            width: 3px;
            background-color: var(--text-main);
            animation: blink 0.7s infinite;
        }

        .sticker-corner {
            position: absolute;
            width: 80px;
            bottom: -30px;
            right: -20px;
            transform: rotate(-10deg);
            z-index: 20;
            transition: transform 0.3s;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2));
        }

        .sticker-corner:hover {
            transform: rotate(0deg) scale(1.1);
        }

        .signature {
            margin-top: 20px;
            text-align: right;
            font-weight: bold;
            font-family: 'Patrick Hand', cursive;
            font-size: 1.5rem;
            color: var(--accent);
        }

        /* Mouse trail effect */
        .sparkle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #fff;
            border-radius: 50%;
            pointer-events: none;
            animation: fadeOut 1s linear forwards;
            z-index: 9999;
        }

        /* =========================================
           4. ANIMATIONS
           ========================================= */
        @keyframes pulse { 0% { transform: translate(-50%, -50%) scale(1); } 50% { transform: translate(-50%, -50%) scale(1.15); } 100% { transform: translate(-50%, -50%) scale(1); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        @keyframes fadeOut { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(0); opacity: 0; } }

        /* Mobile Responsive */
        @media (max-width: 600px) {
            h1 { font-size: 2.5rem; }
            .glass-card { padding: 20px; }
            .content-body { padding: 15px; font-size: 1rem; }
            .highlight-quote { font-size: 1rem; }
            .envelope { width: 260px; }
            .paper-preview { width: 220px; }
        }
    </style>
</head>
<body>

    <audio id="bgMusic" loop>
        <source src="audio/bgmusic.mp3" type="audio/mpeg">
    </audio>

    <canvas id="heart-canvas"></canvas>

    <div id="rain-container"></div>

    <div class="envelope-wrapper" id="envelopeWrapper">
        <div class="envelope" id="envelope">
            <div class="heart-sticker">üíå</div>
            <div class="paper-preview"></div>
        </div>
        <div class="click-hint">Ch·∫°m v√†o bao th∆∞ ƒë·ªÉ m·ªü nha! üëá</div>
    </div>

    <div class="letter-container" id="letterContainer">
        <div class="glass-card" id="glassCard">
            <h1>Hi bn! üëã</h1>
            
            <div class="highlight-quote">
                "Mih ƒë√£ ƒë·ªçc ƒëi ƒë·ªçc l·∫°i t√¢m th∆∞ bn vi·∫øt cho mih h∆°n 10 l·∫ßn lun r√πi nh√©!"
            </div>

            <div class="content-body" id="typewriter-area">
                </div>
            
            <img src="images/chiikawa1.png" class="sticker-corner" alt="Cute" onerror="this.src='https://cdn-icons-png.flaticon.com/512/9307/9307842.png'">
        </div>
    </div>

    <div id="source-text" style="display: none;">
        <p><strong>G·ª≠i b·∫°n,</strong></p>
        <p>L√∫c nh·∫≠n ƒë∆∞·ª£c th∆∞ b·∫°n m√¨nh vui l·∫Øm, kh√¥ng ng·ªù b·∫°n l·∫°i th√≠ch m√≥n qu√† nh·ªè ƒë√≥ ƒë·∫øn v·∫≠y. Th·∫•y b·∫°n c∆∞·ªùi kh√∫c kh√≠ch l√† m√¨nh vui r·ªìi, c√¥ng s·ª©c n·∫Øn n√≥t vi·∫øt th∆∞ tay c·ªßa m√¨nh c≈©ng x·ª©ng ƒë√°ng nh·ªâ? =))</p>
        <p>ƒê·ªçc ƒëo·∫°n b·∫°n n√≥i mu·ªën g·∫∑p m√¨nh ƒë·ªÉ l√†m tr√≤ cho m√¨nh vui, t·ª± nhi√™n th·∫•y m·ªçi stress bay bi·∫øn ƒë√¢u m·∫•t ti√™u lu√¥n. C·∫£m ∆°n b·∫°n nhi·ªÅu l·∫Øm nha. B·∫°n ƒë·ª´ng lo l·∫Øng hay t·ª± tr√°ch m√¨nh ti√™u c·ª±c n·ªØa, c√≥ chuy·ªán g√¨ kh√¥ng vui c·ª© n√≥i m√¨nh n√®, m√¨nh nghe h·∫øt!</p>
        <p>M√¨nh h·ª©a s·∫Ω gi·ªØ g√¨n s·ª©c kh·ªèe th·∫≠t t·ªët ƒë·ªÉ c√≤n h·ªçc h√†nh v√†... nghi√™n c·ª©u ch·∫ø t·∫°o c√°i <strong>m√°y g·∫Øp th√∫ b√¥ng</strong> cho b·∫°n nha!</p>
        <p>B·∫°n c≈©ng nh·ªõ gi·ªØ g√¨n s·ª©c kh·ªèe nha. Mong s·ªõm ƒë∆∞·ª£c g·∫∑p b·∫°n!</p>
        <div class="signature">- mphu -</div>
    </div>

    <script>
        /* =========================================
           PART 1: CONFIGURATION & SETUP
           ========================================= */
        const config = {
            typingSpeed: 50, // ms per char (approx 20 chars/sec -> 4 words/sec)
            particleCount: 80, // S·ªë l∆∞·ª£ng tim n·ªÅn
            rainFrequency: 300, // T·ªëc ƒë·ªô sinh m∆∞a (ms)
        };

        const els = {
            envelopeWrapper: document.getElementById('envelopeWrapper'),
            envelope: document.getElementById('envelope'),
            letterContainer: document.getElementById('letterContainer'),
            glassCard: document.getElementById('glassCard'),
            typewriterArea: document.getElementById('typewriter-area'),
            sourceText: document.getElementById('source-text'),
            audio: document.getElementById('bgMusic'),
            rainContainer: document.getElementById('rain-container')
        };

        /* =========================================
           PART 2: CANVAS HEART BACKGROUND (OPTIMIZED)
           ========================================= */
        const canvas = document.getElementById('heart-canvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let particles = [];

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        class Particle {
            constructor() {
                this.reset();
                this.y = Math.random() * height; // Kh·ªüi t·∫°o ng·∫´u nhi√™n v·ªã tr√≠ ban ƒë·∫ßu
            }

            reset() {
                this.x = Math.random() * width;
                this.y = height + Math.random() * 100;
                this.speed = Math.random() * 1.5 + 0.5;
                this.size = Math.random() * 15 + 5;
                this.opacity = Math.random() * 0.5 + 0.1;
                this.oscillation = Math.random() * 2; // ƒê·ªô l·∫Øc l∆∞
                this.step = 0;
            }

            update() {
                this.y -= this.speed;
                this.step += 0.02;
                this.x += Math.sin(this.step) * 0.5; // Bay l∆∞·ª£n nh·∫π

                if (this.y < -50) this.reset();
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.opacity;
                ctx.fillStyle = '#fff';
                ctx.translate(this.x, this.y);
                // V·∫Ω h√¨nh tr√°i tim b·∫±ng Bezier Curves
                ctx.beginPath();
                const s = this.size / 30; // Scale factor
                ctx.scale(s, s);
                ctx.moveTo(0, 0);
                ctx.bezierCurveTo(-15, -15, -30, 10, 0, 30);
                ctx.bezierCurveTo(30, 10, 15, -15, 0, 0);
                ctx.fill();
                ctx.restore();
            }
        }

        function initParticles() {
            for (let i = 0; i < config.particleCount; i++) {
                particles.push(new Particle());
            }
        }

        function animateCanvas() {
            ctx.clearRect(0, 0, width, height);
            particles.forEach(p => {
                p.update();
                p.draw();
            });
            requestAnimationFrame(animateCanvas);
        }

        initParticles();
        animateCanvas();

        /* =========================================
           PART 3: INTERACTION & ANIMATION FLOW
           ========================================= */
        
        // --- 1. Envelope Click ---
        els.envelopeWrapper.addEventListener('click', () => {
            // 1. Play Music (Quan tr·ªçng: Ph·∫£i g·ªçi trong s·ª± ki·ªán user click)
            els.audio.volume = 0.5; // √Çm l∆∞·ª£ng v·ª´a ph·∫£i
            els.audio.play().catch(e => console.log("Audio autoplay blocked or failed:", e));

            // 2. Animate Envelope
            els.envelope.classList.add('active'); // M·ªü n·∫Øp

            setTimeout(() => {
                // 3. Zoom out & Hide Envelope
                els.envelopeWrapper.classList.add('open');
                
                // 4. Show Letter
                setTimeout(() => {
                    els.letterContainer.classList.add('show');
                    startRain(); // B·∫Øt ƒë·∫ßu m∆∞a
                    typeWriterEffect(); // B·∫Øt ƒë·∫ßu g√µ ch·ªØ
                }, 500);
            }, 1000); // ƒê·ª£i n·∫Øp m·ªü xong
        });

        // --- 2. Typewriter Effect (Smart HTML Parsing) ---
        function typeWriterEffect() {
            const content = els.sourceText.innerHTML;
            const target = els.typewriterArea;
            target.innerHTML = ''; // Clear
            
            let i = 0;
            let currentHTML = '';
            let isTag = false;

            // T·∫°o cursor element
            const cursor = document.createElement('span');
            cursor.className = 'cursor';
            cursor.innerHTML = '&nbsp;';
            
            function type() {
                if (i < content.length) {
                    let char = content.charAt(i);

                    if (char === '<') isTag = true;
                    if (char === '>') {
                        isTag = false;
                        currentHTML += char;
                        i++;
                        type(); // Skip delay for tags
                        return;
                    }

                    currentHTML += char;
                    // Ch·ªâ render khi kh√¥ng ph·∫£i l√† tag ƒëang d·ªü dang
                    if (!isTag) {
                        target.innerHTML = currentHTML;
                        target.appendChild(cursor); // Lu√¥n gi·ªØ cursor ·ªü cu·ªëi
                        setTimeout(type, config.typingSpeed);
                    } else {
                        i++;
                        type(); // Ch·∫°y nhanh qua th·∫ª tag
                        return;
                    }
                    i++;
                } else {
                    cursor.remove(); // X√≥a cursor khi xong
                }
            }
            type();
        }

        // --- 3. Rain Effect (Chiikawa + Emojis) ---
        const rainImages = [
            'images/chiikawa1.png', 
            'images/chiikawa2.png', 
            'images/chiikawa3.png'
        ];
        // Fallback images n·∫øu user ch∆∞a c√≥ file
        const fallbackImages = [
            'https://cdn-icons-png.flaticon.com/512/742/742751.png', // Star
            'https://cdn-icons-png.flaticon.com/512/2904/2904973.png' // Heart
        ];
        const emojis = ['‚≠ê', '‚ù§Ô∏è', '‚ú®', '‚òÅÔ∏è', 'üå∏'];

        function createFallingItem() {
            const item = document.createElement('div');
            item.classList.add('falling-item');
            
            const isImage = Math.random() > 0.4; // 60% Image, 40% Emoji

            if (isImage) {
                const img = document.createElement('img');
                // Logic check ·∫£nh (ƒë∆°n gi·∫£n ho√°: random src)
                const src = rainImages[Math.floor(Math.random() * rainImages.length)];
                img.src = src;
                img.onerror = () => { img.src = fallbackImages[Math.floor(Math.random() * fallbackImages.length)]; };
                img.style.width = Math.random() * 40 + 30 + 'px';
                item.appendChild(img);
            } else {
                item.innerText = emojis[Math.floor(Math.random() * emojis.length)];
                item.style.fontSize = Math.random() * 20 + 15 + 'px';
            }

            // Random v·ªã tr√≠
            item.style.left = Math.random() * 100 + 'vw';
            item.style.animationDuration = Math.random() * 3 + 5 + 's'; // 5-8s r∆°i
            
            els.rainContainer.appendChild(item);

            // Cleanup
            setTimeout(() => { item.remove(); }, 8000);
        }

        function startRain() {
            els.rainContainer.style.display = 'block';
            setInterval(createFallingItem, config.rainFrequency);
        }

        /* =========================================
           PART 4: 3D TILT EFFECT (MOUSE MOVE)
           ========================================= */
        document.addEventListener('mousemove', (e) => {
            // Hi·ªáu ·ª©ng Sparkle (v·ªát chu·ªôt)
            if(Math.random() < 0.3) { // Kh√¥ng t·∫°o qu√° nhi·ªÅu l√†m lag
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.left = e.pageX + 'px';
                sparkle.style.top = e.pageY + 'px';
                document.body.appendChild(sparkle);
                setTimeout(() => sparkle.remove(), 1000);
            }

            // Hi·ªáu ·ª©ng nghi√™ng l√° th∆∞ 3D
            if (els.letterContainer.classList.contains('show')) {
                const xAxis = (window.innerWidth / 2 - e.pageX) / 25;
                const yAxis = (window.innerHeight / 2 - e.pageY) / 25;
                els.glassCard.style.transform = `rotateY(${xAxis}deg) rotateX(${yAxis}deg)`;
            }
        });

    </script>
</body>
</html>
